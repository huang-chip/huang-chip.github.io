<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å°æ·˜åšå£« Â· çŸ¥è¯†ç§‘æ™®å¤§è¯­è¨€æ¨¡å‹</title>
  <meta name="description" content="å°æ·˜åšå£«ï¼šé¢å‘é’å°‘å¹´çš„çŸ¥è¯†ç§‘æ™®é—®ç­”ï¼Œæ–‡å­—+è¯­éŸ³ï¼Œæ”¯æŒæ¥å…¥å¤§è¯­è¨€æ¨¡å‹æ¥å£ã€‚" />
  <style>
    :root{
      --orange:#FFA726;            /* ä¸»è‰²ï¼šå‘æ—¥è‘µæ©˜ */
      --orange-deep:#FB8C00;       /* æ·±æ©˜ */
      --yellow:#FFD54F;            /* ç‚¹ç¼€é»„ */
      --bg:#FFF8E6;                /* æŸ”å’ŒèƒŒæ™¯ */
      --card:#FFFFFF;              /* å¡ç‰‡ç™½ */
      --text:#2B2B2B;              /* ä¸»æ–‡å­— */
      --muted:#6B7280;             /* æ¬¡æ–‡å­— */
      --bubble:#FFFFFF;            /* èŠå¤©æ°”æ³¡ç™½ */
      --bubble-me:#FFF0D9;         /* æˆ‘æ–¹æ°”æ³¡æ·¡æ©˜ */
      --border: #F3D9A4;           /* è¾¹çº¿ */
      --success:#22C55E;
      --danger:#EF4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans SC, Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      color:var(--text); background: radial-gradient(1200px 600px at 10% -10%, #FFE7B3 0%, #FFF8E6 50%, #FFF8E6 100%);
    }
    .app{
      max-width: 980px; margin: 0 auto; padding: 16px; min-height: 100%; display:flex; flex-direction:column; gap:12px;
    }
    .header{
      display:flex; align-items:center; gap:12px; padding:12px 14px; background:linear-gradient(180deg, #FFE8BE 0%, #FFD48A 100%);
      border:2px solid var(--border); border-radius:18px; box-shadow: 0 8px 24px rgba(251,140,0,.15);
    }
    .brand{display:flex; align-items:center; gap:10px}
    .brand h1{margin:0; font-size:20px; font-weight:800; letter-spacing: .5px}
    .tag{font-size:12px; color:#6b4c00; background:#FFF2CC; border:1px dashed #E6C152; padding:4px 8px; border-radius:999px}
    .header-actions{margin-left:auto; display:flex; align-items:center; gap:8px}
    .btn{appearance:none; border:none; cursor:pointer; padding:8px 12px; border-radius:12px; font-weight:700; background:var(--orange); color:#fff; box-shadow:0 4px 10px rgba(251,140,0,.25); transition:.2s}
    .btn:hover{transform:translateY(-1px); background:var(--orange-deep)}
    .btn.secondary{background:#fff; color:#8B5E00; border:2px solid var(--border); box-shadow:none}
    .btn.ghost{background:transparent; color:#8B5E00}

    .sunflower{
      width:44px; height:44px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #FFD54F, #FFB300 70%);
      border:2px solid #F4C65A; position:relative; display:grid; place-items:center; overflow:hidden;
    }
    .sunflower:before, .sunflower:after{
      content:""; position:absolute; width:80px; height:80px; border-radius:50%;
      background: conic-gradient(from 0deg, #FFB74D, #FFC76A, #FFE082, #FFB74D);
      z-index:0; opacity:.65; animation:spin 14s linear infinite;
    }
    .sunflower:after{animation-direction: reverse; opacity:.5}
    @keyframes spin{to{transform:rotate(1turn)}}

    .doc{
      background: var(--card); border:2px solid var(--border); border-radius:18px; overflow:hidden; display:flex; min-height: 68vh;
    }
    .side{
      width: 260px; background: linear-gradient(180deg,#FFF9ED 0%, #FFF3D6 100%); border-right:2px solid var(--border); padding:14px; display:flex; flex-direction:column; gap:12px
    }
    .panel-title{font-weight:800; font-size:14px; color:#7A5200}
    .setting{display:flex; flex-direction:column; gap:6px}
    .input, .select, textarea{
      width:100%; padding:10px 12px; border-radius:12px; border:2px solid var(--border); background:#fff; outline:none; font-size:14px
    }
    .hint{font-size:12px; color:var(--muted)}
    .status{font-size:12px; font-weight:700}

    .main{flex:1; display:flex; flex-direction:column}
    .chat{
      flex:1; padding:14px; overflow:auto; background:linear-gradient(180deg, #FFFDF6 0%, #FFF8E6 100%);
    }
    .bubble-row{display:flex; gap:10px; margin:10px 0}
    .bubble{max-width:70%; padding:12px 14px; border-radius:16px; border:1px solid var(--border); background:var(--bubble); box-shadow:0 4px 10px rgba(255,183,77,.18)}
    .me{margin-left:auto}
    .bubble.me{background:var(--bubble-me)}
    .avatar{
      width:40px; height:40px; border-radius:50%; display:grid; place-items:center; background:#fff; border:2px solid var(--border)
    }

    /* å°åšå£«å½¢è±¡ï¼šç™½è„¸+é»‘è‰²åšå£«å¸½ */
    .mascot{position:relative; width:40px; height:40px}
    .hat{position:absolute; top:-6px; left:4px; width:32px; height:12px; background:#111; border-radius:3px 3px 0 0}
    .hat:after{content:""; position:absolute; top:10px; left:3px; width:26px; height:3px; background:#111; border-radius:2px}
    .face{position:absolute; bottom:0; left:5px; width:30px; height:26px; background:#fff; border:2px solid var(--border); border-radius:14px}
    .eye{position:absolute; width:4px; height:4px; background:#111; border-radius:50%}
    .eye.l{left:8px; top:9px}
    .eye.r{right:8px; top:9px}
    .smile{position:absolute; left:50%; transform:translateX(-50%); bottom:6px; width:12px; height:6px; border:2px solid #111; border-top:none; border-radius:0 0 8px 8px}

    .composer{display:flex; gap:8px; padding:12px; border-top:2px solid var(--border); background:#fff}
    .composer .input{flex:1}

    .pill{padding:6px 10px; border-radius:999px; background:#fff; border:2px solid var(--border); color:#7A5200; font-size:12px; cursor:pointer}
    .pill:hover{background:#FFF4DB}

    .link-list{display:flex; gap:8px; flex-wrap:wrap}

    .footer{font-size:12px; color:var(--muted); text-align:center; padding-bottom:6px}
    .sr{position:absolute; left:-9999px}
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="brand">
        <div class="sunflower" aria-hidden="true"></div>
        <h1>å°æ·˜åšå£« Â· çŸ¥è¯†ç§‘æ™®</h1>
        <span class="tag">å‘æ—¥è‘µæ©˜ Â· é’å°‘å¹´å‹å¥½</span>
      </div>
      <div class="header-actions">
        <button class="btn secondary" id="btn-clear">æ¸…ç©ºå¯¹è¯</button>
        <button class="btn" id="btn-export">å¯¼å‡ºèŠå¤©</button>
        <button class="btn ghost" id="btn-about">å…³äº</button>
      </div>
    </header>

    <section class="doc" role="main">
      <aside class="side" aria-label="è®¾ç½®">
        <div class="panel-title">è¿æ¥å¤§æ¨¡å‹ï¼ˆå¯é€‰ï¼‰</div>
        <div class="setting">
          <label>OpenAI å…¼å®¹ API åœ°å€</label>
          <input class="input" id="api-base" placeholder="å¦‚ https://api.openai.com/v1" />
          <label>API Keyï¼ˆä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼‰</label>
          <input class="input" id="api-key" placeholder="sk-..." />
          <label>æ¨¡å‹å</label>
          <input class="input" id="api-model" placeholder="gpt-4o-mini æˆ– glm-4-flash ç­‰" />
          <button class="btn" id="btn-save">ä¿å­˜è®¾ç½®</button>
          <div class="hint">æœªé…ç½®æ—¶ä½¿ç”¨æœ¬åœ°â€œæ¼”ç¤ºæ¨¡å¼â€ï¼Œå¯ç¦»çº¿å›ç­”åŸºç¡€ç§‘æ™®é—®é¢˜ã€‚</div>
          <div class="status" id="status">å½“å‰ï¼šæ¼”ç¤ºæ¨¡å¼</div>
        </div>
        <hr style="border:none;border-top:2px dashed var(--border)">
        <div class="panel-title">è¯­éŸ³è®¾ç½®</div>
        <div class="setting">
          <label>æœ—è¯»å›ç­”</label>
          <select class="select" id="voice-select"></select>
          <div class="hint">ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦è¯­éŸ³åˆæˆï¼Œç§»åŠ¨ç«¯å…¼å®¹æ€§è§†è®¾å¤‡è€Œå®šã€‚</div>
        </div>
        <hr style="border:none;border-top:2px dashed var(--border)">
        <div class="panel-title">å¿«é€Ÿç¤ºä¾‹</div>
        <div class="link-list">
          <button class="pill ex">æ°´å˜æˆå†°å±äºä»€ä¹ˆç‰©ç†ç°è±¡ï¼Ÿ</button>
          <button class="pill ex">ä¸ºä»€ä¹ˆå¤©ç©ºæ˜¯è“è‰²çš„ï¼Ÿ</button>
          <button class="pill ex">ç«å±±ä¸ºä»€ä¹ˆä¼šå–·å‘ï¼Ÿ</button>
          <button class="pill ex">ä»€ä¹ˆæ˜¯å…‰åˆä½œç”¨ï¼Ÿ</button>
        </div>
      </aside>

      <div class="main">
        <div id="chat" class="chat" aria-live="polite" aria-label="èŠå¤©å†…å®¹"></div>
        <div class="composer">
          <label class="sr" for="ask">è¾“å…¥ä½ çš„é—®é¢˜</label>
          <input id="ask" class="input" placeholder="å’Œå°æ·˜åšå£«èŠèŠç§‘å­¦å§â€¦ å›è½¦å‘é€" />
          <button class="btn" id="send">å‘é€</button>
        </div>
      </div>
    </section>

    <div class="footer">Â© 2025 å°æ·˜åšå£« Â· GitHub Pages å¯ç›´æ¥æ‰˜ç®¡å•æ–‡ä»¶</div>
  </div>

  <template id="tpl-msg">
    <div class="bubble-row">
      <div class="avatar">
        <div class="mascot">
          <div class="hat"></div>
          <div class="face">
            <div class="eye l"></div>
            <div class="eye r"></div>
            <div class="smile"></div>
          </div>
        </div>
      </div>
      <div class="bubble"></div>
    </div>
  </template>

  <template id="tpl-me">
    <div class="bubble-row me">
      <div class="bubble me"></div>
    </div>
  </template>

  <script>
    const $ = (s, p=document) => p.querySelector(s);
    const chat = $('#chat');
    const ask = $('#ask');
    const sendBtn = $('#send');
    const btnClear = $('#btn-clear');
    const btnExport = $('#btn-export');
    const btnAbout = $('#btn-about');
    const statusEl = $('#status');
    const tplMsg = $('#tpl-msg');
    const tplMe = $('#tpl-me');

    const conf = {
      base: localStorage.getItem('xtb_api_base') || '',
      key: localStorage.getItem('xtb_api_key') || '',
      model: localStorage.getItem('xtb_api_model') || ''
    };

    // åˆå§‹åŒ– UI
    $('#api-base').value = conf.base;
    $('#api-key').value = conf.key;
    $('#api-model').value = conf.model;
    updateStatus();

    // è¯­éŸ³åˆæˆ
    const voiceSelect = $('#voice-select');
    let voices = [];
    function populateVoices(){
      voices = window.speechSynthesis ? speechSynthesis.getVoices() : [];
      voiceSelect.innerHTML = '';
      const opts = voices.filter(v=>/zh|cmn|lzh|yue|Chinese/i.test(v.lang)||/child|kids|female/i.test(v.name) || true);
      opts.forEach((v,i)=>{
        const o = document.createElement('option');
        o.value = v.name; o.textContent = `${v.name} (${v.lang})`; voiceSelect.appendChild(o);
      });
    }
    if('speechSynthesis' in window){
      speechSynthesis.onvoiceschanged = populateVoices; populateVoices();
    }
    function speak(text){
      if(!('speechSynthesis' in window)) return;
      const u = new SpeechSynthesisUtterance(text.replace(/\n+/g,' '));
      const name = voiceSelect.value;
      const v = voices.find(v=>v.name===name);
      if(v) u.voice = v;
      u.rate = 1.02; u.pitch = 1.05; u.volume = 1;
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }

    // å°çŸ¥è¯†åº“ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼‰
    const kb = [
      {q:/æ°´.*å˜.*å†°|ç»“å†°|å†°ç‚¹|å†°å†»/, a:`è¿™æ˜¯**å‡å›º**ï¼ˆä¹Ÿå«ç»“å†°ï¼‰ç°è±¡ï¼šç‰©è´¨ç”±æ¶²æ€â†’å›ºæ€çš„**ç‰©æ€å˜åŒ–**ã€‚\næ°´åœ¨æ ‡å‡†å¤§æ°”å‹ä¸‹ **0Â°C** å¼€å§‹ç»“å†°ã€‚è¿‡ç¨‹ä¼´éš**æ”¾çƒ­**ï¼ˆé‡Šæ”¾å‡å›ºæ½œçƒ­ï¼‰ï¼Œæ‰€ä»¥å†°ç®±é‡Œåˆ¶å†°ä¼šæŠŠçƒ­é‡å¸¦èµ°å¹¶æ’åˆ°å¤–é¢ã€‚`, v:["https://www.bilibili.com/video/BV1x4411j7HY"], kw:"å‡å›º ç‰©æ€å˜åŒ– ç»“å†°"},
      {q:/å¤©ç©º.*è“|ä¸ºä»€ä¹ˆ.*è“/, a:`ä¸»è¦å› ä¸º**ç‘åˆ©æ•£å°„**ï¼šé˜³å…‰è¿›å…¥å¤§æ°”å±‚åï¼ŒçŸ­æ³¢é•¿ï¼ˆè“å…‰ï¼‰è¢«ç©ºæ°”åˆ†å­æ›´å¼ºåœ°æ•£å°„ï¼Œå‘å„ä¸ªæ–¹å‘â€œæ´’â€è¿‡æ¥ï¼Œæˆ‘ä»¬æŠ¬å¤´æ›´å¤šçœ‹åˆ°è“è‰²ã€‚\nå‚æ™šåçº¢ï¼Œæ˜¯å› ä¸ºå…‰ç¨‹æ›´é•¿ï¼ŒçŸ­æ³¢è¢«æ•£æ‰ï¼Œé•¿æ³¢ï¼ˆçº¢æ©™ï¼‰ä¿ç•™ä¸‹æ¥ã€‚`, v:["https://www.youtube.com/watch?v=AbfZ5Gm1Ksg"], kw:"ç‘åˆ©æ•£å°„ å¤©ç©ºè“"},
      {q:/ç«å±±.*å–·å‘/, a:`åœ°å¹”éƒ¨åˆ†ç†”èå½¢æˆ**å²©æµ†**ï¼Œåœ¨å‹åŠ›é©±åŠ¨å’Œæ°”ä½“ï¼ˆHâ‚‚Oã€COâ‚‚ ç­‰ï¼‰è†¨èƒ€ä½œç”¨ä¸‹å‘ä¸Šç§»åŠ¨ï¼Œè‹¥å²©æµ†æˆ¿å‹åŠ›è¶…è¿‡åœ°è¡¨æ‰¿è½½ï¼Œå°±ä¼šæ²¿è£‚éš™å–·å‡ºåœ°è¡¨å½¢æˆå–·å‘ã€‚ç±»å‹æœ‰**æº¢æµå¼**ä¸**çˆ†ç‚¸å¼**ç­‰ã€‚`, v:["https://www.bilibili.com/video/BV1qJ411W7c6"], kw:"ç«å±± å²©æµ† å–·å‘"},
      {q:/å…‰åˆ.*ä½œ.*ç”¨|å…‰åˆä½œç”¨/, a:`ç»¿è‰²æ¤ç‰©ã€è—»ç±»å’ŒæŸäº›ç»†èŒåœ¨**å¶ç»¿ä½“**ä¸­ï¼Œåˆ©ç”¨å…‰èƒ½æŠŠ **COâ‚‚ + Hâ‚‚O** è½¬åŒ–ä¸º**æœ‰æœºç‰©ï¼ˆè‘¡è„ç³–ï¼‰**å¹¶é‡Šæ”¾ **Oâ‚‚**ã€‚ç®€å¼ï¼š\n\n**6COâ‚‚ + 6Hâ‚‚O â†’ Câ‚†Hâ‚â‚‚Oâ‚† + 6Oâ‚‚**ï¼ˆå…‰/å¶ç»¿ç´ ï¼‰\n\nå®ƒæ˜¯åœ°çƒç¢³å¾ªç¯ä¸æ°§æ°”æ¥æºçš„æ ¹åŸºã€‚`, v:["https://www.youtube.com/watch?v=LgYPeeABoUs"], kw:"å…‰åˆä½œç”¨ å¶ç»¿ä½“ äºŒæ°§åŒ–ç¢³"}
    ];

    function localAnswer(q){
      for(const item of kb){
        if(item.q.test(q)){
          const links = (item.v||[]).map(u=>`<a href="${u}" target="_blank" rel="noopener">ç›¸å…³è§†é¢‘</a>`).join(' Â· ');
          return `${item.a}\n\n${links ? 'ğŸ“º '+links: ''}`;
        }
      }
      return `æˆ‘æ¥ç”¨ç®€å•è¯­è¨€è§£é‡Šï¼š**${escapeHtml(q)}**ã€‚\n\nç›®å‰å¤„äºâ€œæ¼”ç¤ºæ¨¡å¼â€ï¼Œæˆ‘ä¼šç”¨ç§‘æ™®æ–¹å¼å›ç­”å¸¸è§é—®é¢˜ã€‚è‹¥ä½ åœ¨å·¦ä¾§è®¾ç½®ä¸­æ¥å…¥ **OpenAI å…¼å®¹æ¥å£** ä¸ **API Key**ï¼Œæˆ‘å°±èƒ½åƒè±†åŒ…é‚£æ ·è¿›è¡Œæ›´é€šç”¨ã€æ›´æ·±å…¥çš„å›ç­”ï¼Œè¿˜èƒ½å¼•ç”¨æ›´å¤šçŸ¥è¯†ç‚¹ä¸ä¸¾ä¾‹å™¢ï½`;
    }

    // å‘é€æ¶ˆæ¯
    async function onSend(){
      const text = ask.value.trim();
      if(!text) return;
      addMe(text);
      ask.value='';
      scrollToEnd();

      addBot('æ€è€ƒä¸­â€¦');
      scrollToEnd();

      try{
        const useApi = conf.base && conf.key && conf.model;
        const answer = useApi ? await llmAnswer(text) : localAnswer(text);
        replaceLastBot(answer);
        speak(stripMd(answer));
      }catch(e){
        replaceLastBot(`âŒ å‡ºé”™å•¦ï¼š${e.message||e}`);
      }
      scrollToEnd();
    }

    sendBtn.addEventListener('click', onSend);
    ask.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); onSend(); }});

    // LLM æ¥å…¥ï¼ˆOpenAI å…¼å®¹ï¼‰
    async function llmAnswer(q){
      const url = conf.base.replace(/\/$/, '') + '/chat/completions';
      const sysPrompt = `ä½ æ˜¯â€œ**å°æ·˜åšå£«**â€ï¼Œä¸€ä½é¢å‘ 8-16 å²é’å°‘å¹´çš„ç§‘æ™®åŠ©æ•™ã€‚ç”¨ç®€æ´ã€å‹å¥½ã€æ¯”å–»+ä¾‹å­çš„æ–¹å¼å›ç­”ã€‚è¦æ±‚ï¼š\n1) å…ˆç»™å‡º**ç›´æ¥ç­”æ¡ˆ**ï¼›\n2) å†ç”¨ 2-4 å¥è¯è§£é‡ŠåŸå› ï¼›\n3) å¦‚åˆé€‚ï¼Œé™„ä¸Š 1-2 æ¡**å»¶ä¼¸æ€è€ƒ**ï¼ˆç”¨æ¡ç›®ç¬¦å·ï¼‰ï¼›\n4) ä¿æŒç§¯æã€é¼“åŠ±çš„è¯­æ°”ï¼›\n5) é¿å…æˆäººé»‘è¯ä¸ç¼©å†™ï¼Œæ•°å­¦/ç‰©ç†å…¬å¼å°½é‡ç®€åŒ–ï¼›\n6) è‹¥æ¶‰åŠå±é™©å®éªŒï¼Œæé†’å®‰å…¨æ³¨æ„äº‹é¡¹ã€‚`;
      const body = {
        model: conf.model,
        messages:[
          {role:'system', content: sysPrompt},
          {role:'user', content: q}
        ],
        temperature: 0.7,
      };
      const res = await fetch(url, {
        method:'POST',
        headers:{ 'Content-Type':'application/json', 'Authorization': `Bearer ${conf.key}` },
        body: JSON.stringify(body)
      });
      if(!res.ok){
        const t = await res.text();
        throw new Error(`æ¥å£è¿”å› ${res.status}: ${t}`);
      }
      const data = await res.json();
      const txt = data.choices?.[0]?.message?.content?.trim();
      return txt || 'ï¼ˆæ²¡æœ‰è¿”å›å†…å®¹ï¼‰';
    }

    // DOM å·¥å…·
    function addMe(text){
      const node = tplMe.content.cloneNode(true);
      $('.bubble', node).innerHTML = renderMarkdown(escapeHtml(text));
      chat.appendChild(node);
    }
    function addBot(text){
      const node = tplMsg.content.cloneNode(true);
      $('.bubble', node).innerHTML = renderMarkdown(escapeHtml(text));
      chat.appendChild(node);
    }
    function replaceLastBot(text){
      const rows = chat.querySelectorAll('.bubble-row');
      for(let i=rows.length-1; i>=0; i--){
        if(!rows[i].classList.contains('me')){ $('.bubble', rows[i]).innerHTML = renderMarkdown(escapeHtml(text)); return; }
      }
      addBot(text);
    }
    function scrollToEnd(){ chat.scrollTop = chat.scrollHeight; }

    // Markdown æç®€æ¸²æŸ“ï¼ˆåŠ ç²—ã€è¡Œå†…ä»£ç ã€æ¢è¡Œã€åˆ—è¡¨ã€é“¾æ¥ï¼‰
    function renderMarkdown(s){
      s = s.replace(/\*\*(.*?)\*\*/g, '<strong>$1<\/strong>');
      s = s.replace(/`([^`]+)`/g, '<code>$1<\/code>');
      s = s.replace(/^\s*[-â€¢]\s+(.*)$/gm, '<div>â€¢ $1<\/div>');
      s = s.replace(/\n/g, '<br/>');
      s = s.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" rel="noopener">$1<\/a>');
      return s;
    }
    function stripMd(s){ return s.replace(/\*\*|`/g,''); }
    function escapeHtml(str){
      return str.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    }

    // è®¾ç½®ä¿å­˜
    $('#btn-save').addEventListener('click', ()=>{
      conf.base = $('#api-base').value.trim();
      conf.key = $('#api-key').value.trim();
      conf.model = $('#api-model').value.trim();
      localStorage.setItem('xtb_api_base', conf.base);
      localStorage.setItem('xtb_api_key', conf.key);
      localStorage.setItem('xtb_api_model', conf.model);
      updateStatus();
      toast('è®¾ç½®å·²ä¿å­˜');
    });

    function updateStatus(){
      const useApi = conf.base && conf.key && conf.model;
      statusEl.textContent = 'å½“å‰ï¼š' + (useApi ? `API æ¨¡å¼ï¼ˆ${conf.model}ï¼‰` : 'æ¼”ç¤ºæ¨¡å¼');
      statusEl.style.color = useApi ? 'var(--success)' : 'var(--muted)';
    }

    // ç¤ºä¾‹å¡«å……
    document.querySelectorAll('.ex').forEach(b=>b.addEventListener('click', ()=>{
      ask.value = b.textContent; ask.focus();
    }));

    // æ¸…ç©ºä¸å¯¼å‡º
    btnClear.addEventListener('click', ()=>{ chat.innerHTML = ''; toast('å¯¹è¯å·²æ¸…ç©º'); });
    btnExport.addEventListener('click', ()=>{
      const lines = Array.from(chat.querySelectorAll('.bubble-row')).map(row=>{
        const isMe = row.classList.contains('me');
        const txt = row.querySelector('.bubble').innerText.replace(/\n+/g,'\n');
        return (isMe? 'æˆ‘: ':'å°æ·˜åšå£«: ') + txt;
      }).join('\n\n');
      const blob = new Blob([lines], {type:'text/plain;charset=utf-8'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = 'å°æ·˜åšå£«_èŠå¤©è®°å½•.txt'; a.click();
      URL.revokeObjectURL(a.href);
    });

    // å…³äº
    btnAbout.addEventListener('click', ()=>{
      toast('å°æ·˜åšå£«ï¼šé’å°‘å¹´ç§‘æ™®é—®ç­” Â· å•æ–‡ä»¶ç‰ˆï¼Œå¯ç›´æ¥ä¸Šä¼  GitHub Pages');
    });

    // ç®€æ˜“ Toast
    function toast(msg){
      const div = document.createElement('div');
      div.textContent = msg; div.style.cssText = `position:fixed;left:50%;top:16px;transform:translateX(-50%);background:${'var(--orange)'};color:#fff;padding:8px 12px;border-radius:999px;box-shadow:0 6px 16px rgba(251,140,0,.3);z-index:9999;font-weight:700`;
      document.body.appendChild(div); setTimeout(()=>{div.remove()}, 1800);
    }

    // é¦–æ¡æ¬¢è¿
    addBot('å—¨ï½æˆ‘æ˜¯**å°æ·˜åšå£«**ğŸ§‘â€ğŸ“ï¼\n\nè¯•ç€é—®æˆ‘ï¼š**â€œæ°´å˜æˆå†°å±äºä»€ä¹ˆç‰©ç†ç°è±¡ï¼Ÿâ€**\næˆ‘ä¼šç”¨å°‘å„¿å‹å¥½çš„æ–¹å¼è§£é‡Šï¼Œè¿˜èƒ½æŠŠç­”æ¡ˆ**è¯»å‡ºæ¥**ã€‚å·¦ä¾§å¯ä»¥æ¥å…¥ä½ çš„å¤§æ¨¡å‹ APIï¼Œè®©æˆ‘æ›´èªæ˜ï¼');
  </script>
</body>
</html>
